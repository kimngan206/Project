<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Đơn Hàng & Sản Phẩm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #1f2937;
        }

        /* Tăng độ sâu cho modal */
        .modal-overlay {
            z-index: 50;
        }

        .modal-content {
            z-index: 60;
        }

        h1 {
            color: red;
        }
    </style>
</head>

<body class="flex min-h-screen">

    <!-- Sidebar with White Background and Black Text -->
    <div class="w-64 bg-white text-gray-800 p-6 shadow-xl flex flex-col items-center">
        <h1 class="text-3xl font-bold mb-8">AnhEm Motor</h1>
        <nav class="w-full">
            <ul class="space-y-4">
                <li>
                    <a href="index.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                        <svg class="h-6 w-6 icon-red" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10v10a1 1 0 001 1h3m-12 0h-3" />
                        </svg>
                        <span>Trang chủ</span>
                    </a>
                </li>
                <li>
                    <a href="report.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                        <svg class="h-6 w-6 icon-red" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10v10a1 1 0 001 1h3m-12 0h-3" />
                        </svg>
                        <span>Báo cáo</span>
                    </a>
                </li>
                <li>
                    <a href="revenue.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                        <svg class="h-6 w-6 icon-red" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19V6l-2-2m6 15v-6m6 6V9" />
                        </svg>
                        <span>Phân Tích Doanh Thu</span>
                    </a>
                </li>
                <li>
                    <a href="inventory.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                        <svg class="h-6 w-6 icon-red" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                        </svg>
                        <span>Báo Cáo Sản Phẩm</span>
                    </a>
                </li>
                <li>
                    <a href="quanlykh.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                        <svg class="h-6 w-6 icon-red" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17 20h-4v-4m4 4h-4m4 0h-4M5 12h.01M17 12h.01M12 4v4m0 0v4m0-4h4m-4 0H8" />
                        </svg>
                        <span>Quản lý Khách Hàng</span>
                    </a>
                </li>
                <!-- Dropdown for Order Management -->
                <li>
                    <a href="#" id="nav-order-management"
                        class="nav-link flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200"
                        onclick="toggleDropdown('order-dropdown')">
                        <div class="flex items-center space-x-3">
                            <svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19V6l2-2m6 15v-6m6 6V9" />
                            </svg>
                            <span>Quản lý đơn hàng</span>
                        </div>
                        <svg class="h-4 w-4 transform transition-transform duration-200 text-gray-500"
                            id="order-dropdown-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </a>
                    <ul id="order-dropdown" class="ml-8 mt-2 space-y-2 hidden">
                        <li>
                            <a href="#" id="nav-motorcycle"
                                class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200"
                                onclick="showMainContent('motorcycle')">
                                <span>ĐH Xe Máy</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-parts"
                                class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200"
                                onclick="showMainContent('parts')">
                                <span>ĐH Phụ Tùng</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-accessories"
                                class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200"
                                onclick="showMainContent('accessories')">
                                <span>ĐH Phụ Kiện</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="nhaphang.html"
                        class="flex items-center space-x-3 p-3 rounded-lg sidebar-active transition-colors duration-200">
                        <svg class="h-6 w-6 icon-red" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        <span>Quản lý Nhập Hàng</span>
                    </a>
                </li>
                <li>
                    <a href="quanlysp.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                        <svg class="h-6 w-6 icon-red" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                        </svg>
                        <span>Quản lý Sản Phẩm</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="nav-product-management"
                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200"
                        onclick="showMainContent('product-management')">
                        <svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                        </svg>
                        <span>Quản lý sản phẩm</span>
                    </a>
                </li>
                <li>
                    <a href="#"
                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200">
                        <svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        <span>Quản lý khách hàng</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="nav-customer-orders"
                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200"
                        onclick="showMainContent('customer-orders')">
                        <svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <span>ĐH Của Tôi</span>
                    </a>
                </li>
                <li>
                    <a href="#"
                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200">
                        <svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19V6l-2-2m6 15v-6m6 6V9" />
                        </svg>
                        <span>Báo cáo</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <div class="flex-1 p-8 bg-white" id="main-content-container">

        <!-- Dashboard Section -->
        <div id="content-dashboard" class="content-section">
            <div class="bg-gray-100 p-6 rounded-xl shadow-lg mb-8">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-800">Bảng Điều Khiển Tổng Quan</h1>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-blue-100 p-4 rounded-lg flex flex-col items-center justify-center text-center">
                        <span class="text-4xl font-bold text-blue-600" id="total-orders">0</span>
                        <span class="text-sm font-medium text-blue-800 mt-1">Tổng Số Đơn Hàng</span>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg flex flex-col items-center justify-center text-center">
                        <span class="text-4xl font-bold text-green-600" id="completed-orders">0</span>
                        <span class="text-sm font-medium text-green-800 mt-1">Đã Hoàn Thành</span>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg flex flex-col items-center justify-center text-center">
                        <span class="text-4xl font-bold text-yellow-600" id="pending-orders">0</span>
                        <span class="text-sm font-medium text-yellow-800 mt-1">Đang Chờ Xử Lý</span>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg flex flex-col items-center justify-center text-center">
                        <span class="text-4xl font-bold text-red-600" id="cancelled-orders">0</span>
                        <span class="text-sm font-medium text-red-800 mt-1">Đã Hủy</span>
                    </div>
                </div>
            </div>
            <div class="text-center text-lg text-gray-500 p-10">Chọn một mục quản lý từ menu bên trái.</div>
        </div>

        <!-- Order Management Section -->
        <div id="content-motorcycle" class="content-section hidden">
            <div class="bg-gray-100 p-6 rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-800" id="order-manager-title">Quản Lý Đơn Hàng
                </h1>
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 sm:mb-0">Danh Sách Đơn Hàng</h2>
                    <div class="flex space-x-2" id="filter-buttons">
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden shadow-sm">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Mã ĐH</th>
                                <th class="py-3 px-6 text-left">Khách Hàng</th>
                                <th class="py-3 px-6 text-left">Ngày Đặt</th>
                                <th class="py-3 px-6 text-left">Trạng Thái</th>
                                <th class="py-3 px-6 text-left">Thanh Toán</th>
                                <th class="py-3 px-6 text-left">Tổng Tiền</th>
                                <th class="py-3 px-6 text-center">Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 text-sm font-light" id="order-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="content-parts" class="content-section hidden">
            <div class="bg-gray-100 p-6 rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-800" id="order-manager-title-parts">Quản Lý Đơn
                    Hàng Phụ Tùng</h1>
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 sm:mb-0">Danh Sách Đơn Hàng</h2>
                    <div class="flex space-x-2" id="filter-buttons-parts">
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden shadow-sm">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Mã ĐH</th>
                                <th class="py-3 px-6 text-left">Khách Hàng</th>
                                <th class="py-3 px-6 text-left">Ngày Đặt</th>
                                <th class="py-3 px-6 text-left">Trạng Thái</th>
                                <th class="py-3 px-6 text-left">Thanh Toán</th>
                                <th class="py-3 px-6 text-left">Tổng Tiền</th>
                                <th class="py-3 px-6 text-center">Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 text-sm font-light" id="order-table-body-parts">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="content-accessories" class="content-section hidden">
            <div class="bg-gray-100 p-6 rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-800" id="order-manager-title-accessories">Quản
                    Lý Đơn Hàng Phụ Kiện</h1>
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 sm:mb-0">Danh Sách Đơn Hàng</h2>
                    <div class="flex space-x-2" id="filter-buttons-accessories">
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden shadow-sm">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Mã ĐH</th>
                                <th class="py-3 px-6 text-left">Khách Hàng</th>
                                <th class="py-3 px-6 text-left">Ngày Đặt</th>
                                <th class="py-3 px-6 text-left">Trạng Thái</th>
                                <th class="py-3 px-6 text-left">Thanh Toán</th>
                                <th class="py-3 px-6 text-left">Tổng Tiền</th>
                                <th class="py-3 px-6 text-center">Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 text-sm font-light" id="order-table-body-accessories">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Product Management Section -->
        <div id="content-product-management" class="content-section hidden">
            <div class="bg-gray-100 p-6 rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-800">Quản Lý Sản Phẩm</h1>
                <div class="flex justify-end mb-4">
                    <button onclick="showProductModal()"
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200 shadow-md">
                        Thêm Sản Phẩm Mới
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden shadow-sm">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Mã SP</th>
                                <th class="py-3 px-6 text-left">Tên Sản Phẩm</th>
                                <th class="py-3 px-6 text-left">Loại</th>
                                <th class="py-3 px-6 text-left">Giá</th>
                                <th class="py-3 px-6 text-left">Số Lượng</th>
                                <th class="py-3 px-6 text-center">Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 text-sm font-light" id="product-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- My Orders Section -->
        <div id="content-customer-orders" class="content-section hidden">
            <div class="bg-gray-100 p-6 rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-800">Đơn Hàng Của Tôi</h1>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden shadow-sm">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Mã ĐH</th>
                                <th class="py-3 px-6 text-left">Ngày Đặt</th>
                                <th class="py-3 px-6 text-left">Sản phẩm</th>
                                <th class="py-3 px-6 text-left">Trạng Thái</th>
                                <th class="py-3 px-6 text-left">Thanh Toán</th>
                                <th class="py-3 px-6 text-left">Tổng Tiền</th>
                                <th class="py-3 px-6 text-center">Hành động</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 text-sm font-light" id="customer-order-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- Order Detail Modal -->
    <div id="order-detail-modal"
        class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
        <div class="modal-content bg-white w-full max-w-4xl p-8 rounded-xl shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6 border-b pb-3">
                <h2 class="text-2xl font-bold text-gray-800">Chi Tiết Đơn Hàng: <span id="modal-order-id"></span></h2>
                <button onclick="closeModal('order-detail-modal')"
                    class="text-gray-500 hover:text-gray-800 text-xl font-bold">×</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-4">
                    <p class="text-lg">Khách hàng: <strong id="modal-customer-name"></strong></p>
                    <p class="text-lg">Ngày đặt: <strong id="modal-order-date"></strong></p>
                    <p class="text-xl font-bold">Tổng tiền: <strong class="text-red-500"
                            id="modal-order-total"></strong></p>

                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <h3 class="text-xl font-semibold mb-3">Quản Lý Trạng Thái</h3>

                        <div class="mb-4 flex items-center justify-between">
                            <span class="text-md font-medium">Trạng thái Thanh toán:</span>
                            <span id="modal-payment-status-label"
                                class="px-3 py-1 text-sm font-semibold rounded-full"></span>
                        </div>
                        <button id="btn-confirm-payment" onclick="confirmPayment()"
                            class="w-full bg-green-500 text-white py-2 rounded-lg font-semibold hover:bg-green-600 transition-colors duration-200 disabled:bg-gray-400"
                            disabled>
                            Xác Nhận Đã Thanh Toán
                        </button>
                        <hr class="my-4">

                        <div class="mb-4">
                            <label for="modal-status-select" class="block text-md font-medium text-gray-700 mb-2">Cập
                                nhật Trạng Thái Đơn Hàng</label>
                            <select id="modal-status-select"
                                class="w-full border-gray-300 rounded-lg shadow-sm focus:border-red-500 focus:ring-red-500"
                                onchange="updateStatusFromModal(this.value)">
                            </select>
                        </div>
                        <div id="motorcycle-email-btn-container" class="hidden">
                            <button onclick="sendCustomerNotification()"
                                class="w-full bg-yellow-500 text-white py-2 rounded-lg font-semibold hover:bg-yellow-600 transition-colors duration-200 mt-2">
                                Gửi Email Nhận Xe (Hàng đã có)
                            </button>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-1 space-y-4">
                    <h3 class="text-xl font-semibold">Ảnh Giao Hàng</h3>
                    <div id="image-preview-container"
                        class="border p-4 rounded-lg bg-white h-48 flex items-center justify-center text-gray-500">
                    </div>
                    <div>
                        <input type="file" id="delivery-image-upload" accept="image/*"
                            class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100" />
                        <button onclick="uploadDeliveryImage()" id="btn-upload-image"
                            class="w-full bg-red-500 text-white py-2 mt-2 rounded-lg font-semibold hover:bg-red-600 transition-colors duration-200">
                            Tải Ảnh
                        </button>
                    </div>
                </div>
            </div>

            <h3 class="text-xl font-semibold mt-6 mb-3 border-t pt-4">Sản Phẩm Trong Đơn Hàng</h3>
            <div class="overflow-x-auto max-h-48">
                <table class="min-w-full bg-white border">
                    <thead>
                        <tr class="bg-gray-100 text-gray-600 uppercase text-xs leading-normal">
                            <th class="py-2 px-4 text-left">Tên Sản Phẩm</th>
                            <th class="py-2 px-4 text-right">Số lượng</th>
                            <th class="py-2 px-4 text-right">Giá (VNĐ)</th>
                        </tr>
                    </thead>
                    <tbody id="modal-products-list">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="product-modal"
        class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
        <div class="modal-content bg-white w-full max-w-xl p-8 rounded-xl shadow-2xl">
            <div class="flex justify-between items-center mb-6 border-b pb-3">
                <h2 class="text-2xl font-bold text-gray-800" id="product-modal-title">Thêm Sản Phẩm Mới</h2>
                <button onclick="closeModal('product-modal')"
                    class="text-gray-500 hover:text-gray-800 text-xl font-bold">×</button>
            </div>
            <form id="product-form" class="space-y-4">
                <div>
                    <label for="product-id" class="block text-sm font-medium text-gray-700">Mã Sản Phẩm</label>
                    <input type="text" id="product-id" name="id"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500"
                        required>
                </div>
                <div>
                    <label for="product-name" class="block text-sm font-medium text-gray-700">Tên Sản Phẩm</label>
                    <input type="text" id="product-name" name="name"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500"
                        required>
                </div>
                <div>
                    <label for="product-type" class="block text-sm font-medium text-gray-700">Loại</label>
                    <select id="product-type" name="type"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500"
                        required>
                        <option value="motorcycle">Xe Máy</option>
                        <option value="parts">Phụ Tùng</option>
                        <option value="accessories">Phụ Kiện</option>
                    </select>
                </div>
                <div>
                    <label for="product-price" class="block text-sm font-medium text-gray-700">Giá (VNĐ)</label>
                    <input type="number" id="product-price" name="price"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500"
                        required>
                </div>
                <div>
                    <label for="product-stock" class="block text-sm font-medium text-gray-700">Số Lượng</label>
                    <input type="number" id="product-stock" name="stock"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500"
                        required>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeModal('product-modal')"
                        class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400 transition-colors duration-200">
                        Hủy
                    </button>
                    <button type="submit"
                        class="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition-colors duration-200">
                        Lưu Sản Phẩm
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- DATA AND CONFIGURATION ---
        let orders = JSON.parse(localStorage.getItem('orders')) || [
            // Motorcycle Order Status: 'confirmed', 'completed', 'delivered'
            { id: 'ORD-001', customerName: 'Nguyễn Văn A', date: '2023-10-26', type: 'motorcycle', status: 'completed', paymentStatus: 'paid', total: 55000000, deliveryImage: 'motorcycle_delivered.jpg', products: [{ name: 'Xe Vision 2023', qty: 1, price: 55000000 }] },
            { id: 'ORD-002', customerName: 'Trần Thị B', date: '2023-10-25', type: 'motorcycle', status: 'confirmed', paymentStatus: 'unpaid', total: 42000000, deliveryImage: null, products: [{ name: 'Xe Exciter 155', qty: 1, price: 42000000 }] },
            // Parts Order Status: 'unconfirmed', 'confirmed', 'shipping', 'completed'
            { id: 'ORD-003', customerName: 'Lê Văn C', date: '2023-10-24', type: 'parts', status: 'confirmed', paymentStatus: 'paid', total: 3500000, deliveryImage: null, products: [{ name: 'Lốp Michelin City', qty: 2, price: 1750000 }] },
            { id: 'ORD-004', customerName: 'Phạm Thị D', date: '2023-10-23', type: 'accessories', status: 'shipping', paymentStatus: 'unpaid', total: 490000, deliveryImage: null, products: [{ name: 'Mũ bảo hiểm fullface', qty: 1, price: 490000 }] },
            { id: 'ORD-005', customerName: 'Hoàng Thị E', date: '2023-10-22', type: 'accessories', status: 'unconfirmed', paymentStatus: 'unpaid', total: 120000, deliveryImage: null, products: [{ name: 'Khóa chống trộm', qty: 1, price: 120000 }] },
            { id: 'ORD-006', customerName: 'Vũ Văn F', date: '2023-10-21', type: 'parts', status: 'completed', paymentStatus: 'paid', total: 280000, deliveryImage: 'parts_delivered.jpg', products: [{ name: 'Dầu nhớt Castrol', qty: 4, price: 70000 }] }
        ];

        let products = JSON.parse(localStorage.getItem('products')) || [
            { id: 'SP-001', name: 'Xe Vision 2023', type: 'motorcycle', price: 55000000, stock: 10 },
            { id: 'SP-002', name: 'Lốp Michelin City', type: 'parts', price: 1750000, stock: 50 },
            { id: 'SP-003', name: 'Mũ bảo hiểm fullface', type: 'accessories', price: 490000, stock: 100 },
            { id: 'SP-004', name: 'Dầu nhớt Castrol', type: 'parts', price: 70000, stock: 200 }
        ];

        let currentEditingProduct = null;

        let currentFilter = 'all';
        let currentOrderType = 'motorcycle'; // Tracks which manager page is active
        let currentDetailIndex = -1; // Index of the order being viewed in the modal

        const paymentStatusText = {
            'paid': 'Đã Thanh Toán',
            'unpaid': 'Chưa Thanh Toán'
        };
        const paymentStatusColors = {
            'paid': 'bg-green-100 text-green-800',
            'unpaid': 'bg-red-100 text-red-800'
        };

        const statusMaps = {
            'motorcycle': {
                'confirmed': { text: 'Đã Xác Nhận (Chưa TT)', color: 'bg-yellow-100 text-yellow-800', canCancel: true },
                'completed': { text: 'Đã Hoàn Thành', color: 'bg-green-100 text-green-800', canCancel: false },
                'delivered': { text: 'Đã Giao', color: 'bg-blue-100 text-blue-800', canCancel: false }
            },
            'parts': {
                'unconfirmed': { text: 'Chưa Xác Nhận', color: 'bg-red-100 text-red-800', canCancel: true },
                'confirmed': { text: 'Đã Xác Nhận', color: 'bg-yellow-100 text-yellow-800', canCancel: true },
                'shipping': { text: 'Đang Giao Hàng', color: 'bg-blue-100 text-blue-800', canCancel: true },
                'completed': { text: 'Đã Giao - Hoàn Thành', color: 'bg-green-100 text-green-800', canCancel: false }
            },
            'accessories': {
                'unconfirmed': { text: 'Chưa Xác Nhận', color: 'bg-red-100 text-red-800', canCancel: true },
                'confirmed': { text: 'Đã Xác Nhận', color: 'bg-yellow-100 text-yellow-800', canCancel: true },
                'shipping': { text: 'Đang Giao Hàng', color: 'bg-blue-100 text-blue-800', canCancel: true },
                'completed': { text: 'Đã Giao - Hoàn Thành', color: 'bg-green-100 text-green-800', canCancel: false }
            }
        };

        // --- CORE UI/DATA FUNCTIONS ---

        function getStatusInfo(type, status) {
            return statusMaps[type][status] || { text: status, color: 'bg-gray-100 text-gray-800', canCancel: false };
        }

        function saveData() {
            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.setItem('products', JSON.stringify(products));
        }

        function updateDashboard() {
            document.getElementById('total-orders').textContent = orders.length;
            const statusCounts = orders.reduce((acc, order) => {
                acc[order.status] = (acc[order.status] || 0) + 1;
                return acc;
            }, {});
            // Count based on the new statuses
            const completed = orders.filter(o => o.status === 'completed' || o.status === 'delivered').length;
            const pending = orders.filter(o => o.status === 'confirmed' || o.status === 'unconfirmed' || o.status === 'shipping').length;
            const cancelled = 0;

            document.getElementById('completed-orders').textContent = completed;
            document.getElementById('pending-orders').textContent = pending;
            document.getElementById('cancelled-orders').textContent = cancelled;
        }

        function renderOrders(orderList, type) {
            const tableBodyId = `order-table-body-${type}`;
            const tableBody = document.getElementById(tableBodyId);
            if (!tableBody) return; // Exit if the element is not found

            tableBody.innerHTML = '';
            orderList.forEach((order, index) => {
                const statusInfo = getStatusInfo(order.type, order.status);
                const paymentColor = paymentStatusColors[order.paymentStatus];
                const paymentLabel = paymentStatusText[order.paymentStatus];

                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-50 transition-colors duration-200';

                // Find the actual index in the main `orders` array for operations like details/delete
                const globalIndex = orders.findIndex(o => o.id === order.id);

                row.innerHTML = `
                    <td class="py-3 px-6 text-left whitespace-nowrap">${order.id}</td>
                    <td class="py-3 px-6 text-left">${order.customerName}</td>
                    <td class="py-3 px-6 text-left">${order.date}</td>
                    <td class="py-3 px-6 text-left">
                        <span class="px-2 py-1 font-semibold leading-tight ${statusInfo.color} rounded-full">${statusInfo.text}</span>
                    </td>
                    <td class="py-3 px-6 text-left">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${paymentColor}">${paymentLabel}</span>
                    </td>
                    <td class="py-3 px-6 text-left">${order.total.toLocaleString('vi-VN')} VNĐ</td>
                    <td class="py-3 px-6 text-center">
                        <button onclick="showDetailModal(${globalIndex})" class="px-3 py-1 text-xs font-medium text-red-600 bg-red-100 rounded-lg hover:bg-red-200 transition-colors duration-200">Chi Tiết</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function filterOrders(status, type) {
            currentFilter = status;
            currentOrderType = type;
            const filterButtonsContainer = document.getElementById(`filter-buttons-${type}`);
            if (!filterButtonsContainer) return;

            const buttons = filterButtonsContainer.querySelectorAll('button');

            buttons.forEach(btn => {
                btn.classList.remove('bg-red-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });

            let filteredList = orders.filter(order => order.type === currentOrderType);
            if (status !== 'all') {
                filteredList = filteredList.filter(order => order.status === status);
            }

            const activeBtn = document.getElementById(`filter-${status}-${type}`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
                activeBtn.classList.add('bg-red-500', 'text-white');
            }

            renderOrders(filteredList, type);
        }

        function renderProducts() {
            const tableBody = document.getElementById('product-table-body');
            tableBody.innerHTML = '';
            products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-50 transition-colors duration-200';

                const productType = product.type === 'motorcycle' ? 'Xe Máy' : product.type === 'parts' ? 'Phụ Tùng' : 'Phụ Kiện';

                row.innerHTML = `
                    <td class="py-3 px-6 text-left whitespace-nowrap">${product.id}</td>
                    <td class="py-3 px-6 text-left">${product.name}</td>
                    <td class="py-3 px-6 text-left">${productType}</td>
                    <td class="py-3 px-6 text-left">${product.price.toLocaleString('vi-VN')} VNĐ</td>
                    <td class="py-3 px-6 text-left">${product.stock}</td>
                    <td class="py-3 px-6 text-center space-x-2">
                        <button onclick="showProductModal(${index})" class="px-3 py-1 text-xs font-medium text-red-600 bg-red-100 rounded-lg hover:bg-red-200 transition-colors duration-200">Sửa</button>
                        <button onclick="deleteProduct(${index})" class="px-3 py-1 text-xs font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors duration-200">Xóa</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // --- SCREEN MANAGEMENT ---
        function setupOrderManagementScreen(type) {
            currentOrderType = type;
            const titleElement = document.getElementById(`order-manager-title-${type}`);
            const filterContainer = document.getElementById(`filter-buttons-${type}`);
            const statuses = statusMaps[type];
            let buttonsHTML = `<button onclick="filterOrders('all', '${type}')" id="filter-all-${type}" class="px-4 py-2 rounded-lg text-sm font-medium bg-red-500 text-white hover:bg-red-600 transition-colors duration-200">Tất Cả</button>`;

            for (const status in statuses) {
                buttonsHTML += `<button onclick="filterOrders('${status}', '${type}')" id="filter-${status}-${type}" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors duration-200">${statuses[status].text}</button>`;
            }

            filterContainer.innerHTML = buttonsHTML;
            filterOrders('all', type); // Initialize with 'all' filter
        }

        function showMainContent(sectionId) {
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Remove active style from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('bg-gray-200');
                link.classList.remove('font-semibold');
            });

            // Hide all dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
                dropdown.classList.add('hidden');
            });

            // Show the selected section and add active style
            document.getElementById('content-' + sectionId).classList.remove('hidden');

            // Add active style to the specific nav item, considering dropdowns
            const navLink = document.getElementById('nav-' + sectionId);
            if (navLink) {
                navLink.classList.add('bg-gray-200', 'font-semibold');
            }
            if (sectionId.startsWith('motorcycle') || sectionId.startsWith('parts') || sectionId.startsWith('accessories')) {
                document.getElementById('nav-order-management').classList.add('bg-gray-200', 'font-semibold');
                document.getElementById('order-dropdown').classList.remove('hidden');
                document.getElementById('order-dropdown-icon').classList.add('-rotate-90');
            }


            // Specific setup for each section
            if (sectionId === 'dashboard') {
                updateDashboard();
            } else if (sectionId === 'motorcycle' || sectionId === 'parts' || sectionId === 'accessories') {
                setupOrderManagementScreen(sectionId);
            } else if (sectionId === 'customer-orders') {
                renderCustomerOrders();
            } else if (sectionId === 'product-management') {
                renderProducts();
            }
        }

        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const icon = document.getElementById(`${dropdownId}-icon`);
            const navLink = document.getElementById('nav-order-management');

            dropdown.classList.toggle('hidden');
            icon.classList.toggle('-rotate-90');
            navLink.classList.toggle('bg-gray-200');
            navLink.classList.toggle('font-semibold');

            // If the dropdown is being opened, hide other sections
            if (!dropdown.classList.contains('hidden')) {
                // You may want to do nothing, as showMainContent handles hiding others
            }
        }


        // --- MODAL FUNCTIONS ---

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            // Re-render the table to reflect any changes
            if (modalId === 'order-detail-modal') {
                filterOrders(currentFilter, currentOrderType);
            } else if (modalId === 'product-modal') {
                renderProducts();
            }
        }

        // --- ORDER ACTION FUNCTIONS ---

        function showDetailModal(index) {
            currentDetailIndex = index;
            const order = orders[index];
            const type = order.type;
            const statusOptions = statusMaps[type];

            // 1. Fill basic info
            document.getElementById('modal-order-id').textContent = order.id;
            document.getElementById('modal-customer-name').textContent = order.customerName;
            document.getElementById('modal-order-date').textContent = order.date;
            document.getElementById('modal-order-total').textContent = order.total.toLocaleString('vi-VN') + ' VNĐ';

            // 2. Payment Status
            const paymentLabel = document.getElementById('modal-payment-status-label');
            paymentLabel.textContent = paymentStatusText[order.paymentStatus];
            paymentLabel.className = `px-3 py-1 text-sm font-semibold rounded-full ${paymentStatusColors[order.paymentStatus]}`;

            const confirmBtn = document.getElementById('btn-confirm-payment');
            confirmBtn.disabled = order.paymentStatus === 'paid';
            if (order.paymentStatus === 'paid') {
                confirmBtn.textContent = 'Đã Thanh Toán';
            } else {
                confirmBtn.textContent = 'Xác Nhận Đã Thanh Toán';
            }

            // 3. Status Select
            const statusSelect = document.getElementById('modal-status-select');
            statusSelect.innerHTML = '';
            for (const status in statusOptions) {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = statusOptions[status].text;
                if (status === order.status) {
                    option.selected = true;
                }
                statusSelect.appendChild(option);
            }

            // 4. Motorcycle-specific button
            const motorcycleEmailContainer = document.getElementById('motorcycle-email-btn-container');
            if (type === 'motorcycle') {
                motorcycleEmailContainer.classList.remove('hidden');
            } else {
                motorcycleEmailContainer.classList.add('hidden');
            }

            // 5. Products List
            const productsList = document.getElementById('modal-products-list');
            productsList.innerHTML = '';
            order.products.forEach(p => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="py-2 px-4 whitespace-nowrap">${p.name}</td>
                    <td class="py-2 px-4 text-right">${p.qty}</td>
                    <td class="py-2 px-4 text-right">${p.price.toLocaleString('vi-VN')}</td>
                `;
                productsList.appendChild(row);
            });

            // 6. Image Preview
            updateImagePreview(order.deliveryImage);

            // 7. Show modal
            document.getElementById('order-detail-modal').classList.remove('hidden');
        }

        function updateStatusFromModal(newStatus) {
            if (currentDetailIndex !== -1) {
                const order = orders[currentDetailIndex];
                order.status = newStatus;
                updateDashboard();
                saveData();
                alert(`Trạng thái đơn hàng ${order.id} đã được cập nhật thành: ${getStatusInfo(order.type, newStatus).text}`);
                showDetailModal(currentDetailIndex); // Reload modal to show current status
            }
        }

        function confirmPayment() {
            if (currentDetailIndex !== -1) {
                const order = orders[currentDetailIndex];
                if (order.paymentStatus !== 'paid') {
                    order.paymentStatus = 'paid';
                    saveData();
                    alert(`Đơn hàng ${order.id} đã được xác nhận thanh toán thành công!`);
                    showDetailModal(currentDetailIndex); // Reload modal
                }
            }
        }

        function sendCustomerNotification() {
            if (currentDetailIndex !== -1) {
                const order = orders[currentDetailIndex];
                if (order.type === 'motorcycle' && (order.status === 'confirmed' || order.status === 'completed')) {
                    alert(`Thông báo đã được gửi đến email khách hàng ${order.customerName} để nhận xe ${order.id}.`);
                } else {
                    alert('Đơn hàng chưa đủ điều kiện để gửi thông báo nhận xe.');
                }
            }
        }

        function updateImagePreview(imageName) {
            const container = document.getElementById('image-preview-container');
            if (imageName) {
                container.innerHTML = `<p class="text-green-600 font-bold">Ảnh đã được tải lên! (${imageName})</p> <span class="text-xs">Click vào đây để xem ảnh (Giả lập)</span>`;
            } else {
                container.innerHTML = 'Chưa có ảnh giao hàng được tải lên.';
            }
        }

        function uploadDeliveryImage() {
            const fileInput = document.getElementById('delivery-image-upload');
            if (currentDetailIndex !== -1 && fileInput.files.length > 0) {
                const order = orders[currentDetailIndex];
                const simulatedFileName = `img_${order.id}_${Date.now()}.jpg`;
                order.deliveryImage = simulatedFileName;
                saveData();
                alert(`Ảnh giao hàng cho đơn ${order.id} đã được tải lên thành công!`);
                updateImagePreview(simulatedFileName);
                showDetailModal(currentDetailIndex); // Re-render to update view
            } else {
                alert('Vui lòng chọn một tệp ảnh để tải lên.');
            }
        }

        // --- CUSTOMER VIEW FUNCTIONS ---
        function renderCustomerOrders() {
            const customerTableBody = document.getElementById('customer-order-table-body');
            customerTableBody.innerHTML = '';

            const customerOrders = [...orders].sort((a, b) => new Date(b.date) - new Date(a.date));

            customerOrders.forEach((order, index) => {
                const statusInfo = getStatusInfo(order.type, order.status);
                const paymentColor = paymentStatusColors[order.paymentStatus];
                const paymentLabel = paymentStatusText[order.paymentStatus];

                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-50 transition-colors duration-200';

                const globalIndex = orders.findIndex(o => o.id === order.id);

                const canCancel = statusInfo.canCancel;
                let actionButton = '';
                if (canCancel) {
                    actionButton = `<button onclick="cancelCustomerOrder(${globalIndex})" class="px-3 py-1 text-xs font-medium text-red-600 bg-red-100 rounded-lg hover:bg-red-200 transition-colors duration-200">Hủy Đơn</button>`;
                } else if (order.deliveryImage) {
                    actionButton = `<button onclick="viewDeliveryImageCustomer(${globalIndex})" class="px-3 py-1 text-xs font-medium text-green-600 bg-green-100 rounded-lg hover:bg-green-200 transition-colors duration-200">Xem Ảnh Giao</button>`;
                } else {
                    actionButton = `<span class="text-gray-400">Không thể hủy</span>`;
                }


                row.innerHTML = `
                    <td class="py-3 px-6 text-left whitespace-nowrap">${order.id}</td>
                    <td class="py-3 px-6 text-left">${order.date}</td>
                    <td class="py-3 px-6 text-left">${order.products.length} sản phẩm (${order.type === 'motorcycle' ? 'Xe Máy' : order.type === 'parts' ? 'Phụ Tùng' : 'Phụ Kiện'})</td>
                    <td class="py-3 px-6 text-left">
                        <span class="px-2 py-1 font-semibold leading-tight ${statusInfo.color} rounded-full">${statusInfo.text}</span>
                    </td>
                    <td class="py-3 px-6 text-left">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${paymentColor}">${paymentLabel}</span>
                    </td>
                    <td class="py-3 px-6 text-left">${order.total.toLocaleString('vi-VN')} VNĐ</td>
                    <td class="py-3 px-6 text-center">${actionButton}</td>
                `;
                customerTableBody.appendChild(row);
            });
        }

        function cancelCustomerOrder(index) {
            const order = orders[index];
            if (confirm(`Bạn có chắc chắn muốn hủy đơn hàng ${order.id} của mình?`)) {
                orders.splice(index, 1);
                updateDashboard();
                saveData();
                renderCustomerOrders();
                alert(`Đơn hàng ${order.id} đã bị hủy thành công.`);
            }
        }

        function viewDeliveryImageCustomer(index) {
            const order = orders[index];
            if (order.deliveryImage) {
                alert(`Khách hàng có thể xem ảnh giao hàng: ${order.deliveryImage} (Giả lập)`);
            }
        }

        // --- PRODUCT ACTION FUNCTIONS ---
        function showProductModal(index = null) {
            const modal = document.getElementById('product-modal');
            const title = document.getElementById('product-modal-title');
            const form = document.getElementById('product-form');
            form.reset();
            currentEditingProduct = null;
            document.getElementById('product-id').disabled = false;

            if (index !== null) {
                currentEditingProduct = products[index];
                title.textContent = 'Sửa Sản Phẩm';
                document.getElementById('product-id').value = currentEditingProduct.id;
                document.getElementById('product-id').disabled = true;
                document.getElementById('product-name').value = currentEditingProduct.name;
                document.getElementById('product-type').value = currentEditingProduct.type;
                document.getElementById('product-price').value = currentEditingProduct.price;
                document.getElementById('product-stock').value = currentEditingProduct.stock;
            } else {
                title.textContent = 'Thêm Sản Phẩm Mới';
            }
            modal.classList.remove('hidden');
        }

        document.getElementById('product-form').addEventListener('submit', function (event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const product = {
                id: formData.get('id'),
                name: formData.get('name'),
                type: formData.get('type'),
                price: parseInt(formData.get('price')),
                stock: parseInt(formData.get('stock'))
            };

            if (currentEditingProduct) {
                const index = products.findIndex(p => p.id === currentEditingProduct.id);
                if (index !== -1) {
                    products[index] = { ...products[index], ...product };
                    alert('Sản phẩm đã được cập nhật thành công!');
                }
            } else {
                if (products.some(p => p.id === product.id)) {
                    alert('Mã sản phẩm đã tồn tại. Vui lòng sử dụng mã khác.');
                    return;
                }
                products.push(product);
                alert('Sản phẩm đã được thêm thành công!');
            }
            saveData();
            closeModal('product-modal');
        });

        function deleteProduct(index) {
            const product = products[index];
            if (confirm(`Bạn có chắc chắn muốn xóa sản phẩm ${product.name} (ID: ${product.id})?`)) {
                products.splice(index, 1);
                saveData();
                renderProducts();
                alert('Sản phẩm đã được xóa thành công!');
            }
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            updateDashboard();
            showMainContent('dashboard'); // Start on the dashboard
        });
    </script>

</body>

</html>