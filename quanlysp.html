<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh Sách Sản Phẩm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #1f2937;
        }

        .file-input {
            opacity: 0;
            position: absolute;
            z-index: -1;
        }
    </style>
</head>

<body class="flex min-h-screen">

    <!-- Sidebar -->
    <div class="w-64 bg-blue-900 text-white p-6 shadow-xl flex flex-col items-center">
        <h1 class="text-3xl font-bold mb-8">Admin Panel</h1>
        <nav class="w-full">
            <ul class="space-y-4">
                <li>
                    <a href="#"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-800 transition-colors duration-200">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10v10a1 1 0 001 1h3m-12 0h-3" />
                        </svg>
                        <span>Trang chủ</span>
                    </a>
                </li>
                <li>
                    <a href="quanlysp.html"
                        class="flex items-center space-x-3 p-3 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                        </svg>
                        <span>Danh sách sản phẩm</span>
                    </a>
                </li>
                <li>
                    <a href="themsp.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-800 transition-colors duration-200">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                        <span>Thêm sản phẩm</span>
                    </a>
                </li>
                <li>
                    <a href="#"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-800 transition-colors duration-200">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        <span>Quản lý khách hàng</span>
                    </a>
                </li>
                <li>
                    <a href="order1.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-800 transition-colors duration-200">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M12 16h.01" />
                        </svg>
                        <span>Quản lý đơn hàng</span>
                    </a>
                </li>
                <li>
                    <a href="nhaphang.html"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-800 transition-colors duration-200">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19V6l-2-2m6 15v-6m6 6V9" />
                        </svg>
                        <span>Quản lý nhập hàng</span>
                    </a>
                </li>
                <li>
                    <a href="#"
                        class="flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-800 transition-colors duration-200">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19V6l-2-2m6 15v-6m6 6V9" />
                        </svg>
                        <span>Báo cáo</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="flex-1 p-8">
        <!-- Dashboard Stats -->
        <div class="bg-gray-100 p-6 rounded-xl shadow-lg mb-8">
            <h1 class="text-3xl font-bold mb-4 text-center text-gray-800">Danh Sách Sản Phẩm</h1>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-blue-100 p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <span class="text-4xl font-bold text-blue-600" id="total-products">0</span>
                    <span class="text-sm font-medium text-blue-800 mt-1">Tổng Số Sản Phẩm</span>
                </div>
                <div class="bg-green-100 p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <span class="text-4xl font-bold text-green-600" id="in-stock-products">0</span>
                    <span class="text-sm font-medium text-green-800 mt-1">Sản Phẩm Còn Hàng</span>
                </div>
                <div class="bg-yellow-100 p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <span class="text-4xl font-bold text-yellow-600" id="low-stock-products">0</span>
                    <span class="text-sm font-medium text-yellow-800 mt-1">Sản Phẩm Sắp Hết</span>
                </div>
                <div class="bg-red-100 p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <span class="text-4xl font-bold text-red-600" id="out-of-stock-products">0</span>
                    <span class="text-sm font-medium text-red-800 mt-1">Sản Phẩm Hết Hàng</span>
                </div>
            </div>
        </div>

        <!-- Product List Section -->
        <div class="bg-gray-100 p-6 rounded-xl shadow-lg">
            <div
                class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 space-y-4 lg:space-y-0">
                <h2 class="text-2xl font-semibold text-gray-800">Danh Sách Sản Phẩm</h2>

                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full lg:w-auto">
                    <div class="flex space-x-2">
                        <label for="excel-import"
                            class="px-4 py-2 rounded-lg text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 cursor-pointer flex items-center space-x-2">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                            </svg>
                            <span>Import Excel</span>
                        </label>
                        <input type="file" id="excel-import" accept=".xlsx,.xls" onchange="importExcel(event)"
                            class="file-input">

                        <button onclick="exportExcel()"
                            class="px-4 py-2 rounded-lg text-sm font-medium bg-green-600 text-white hover:bg-green-700 transition-colors duration-200 flex items-center space-x-2">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <span>Export Excel</span>
                        </button>
                    </div>

                    <div class="flex space-x-2">
                        <button onclick="filterProducts('all')" id="filter-all"
                            class="px-4 py-2 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors duration-200">Tất
                            Cả</button>
                        <button onclick="filterProducts('in-stock')" id="filter-in-stock"
                            class="px-4 py-2 rounded-lg text-sm font-medium bg-green-400 text-green-800 hover:bg-green-500 transition-colors duration-200">Còn
                            Hàng</button>
                        <button onclick="filterProducts('low-stock')" id="filter-low-stock"
                            class="px-4 py-2 rounded-lg text-sm font-medium bg-yellow-400 text-yellow-800 hover:bg-yellow-500 transition-colors duration-200">Sắp
                            Hết</button>
                        <button onclick="filterProducts('out-of-stock')" id="filter-out-of-stock"
                            class="px-4 py-2 rounded-lg text-sm font-medium bg-red-400 text-red-800 hover:bg-red-500 transition-colors duration-200">Hết
                            Hàng</button>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <input type="text" id="search-input" placeholder="Tìm kiếm sản phẩm..." onkeyup="searchProducts()"
                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full bg-gray-100 rounded-lg overflow-hidden shadow-sm">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-3 px-6 text-left">Mã SP</th>
                            <th class="py-3 px-6 text-left">Tên Sản Phẩm</th>
                            <th class="py-3 px-6 text-left">Danh Mục</th>
                            <th class="py-3 px-6 text-left">Giá Bán</th>
                            <th class="py-3 px-6 text-left">Số Lượng</th>
                            <th class="py-3 px-6 text-left">Trạng Thái</th>
                            <th class="py-3 px-6 text-center">Thao Tác</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-600 text-sm font-light" id="product-table-body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-2xl mx-4">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Chỉnh Sửa Sản Phẩm</h2>
            <form id="edit-product-form" onsubmit="updateProduct(event)">
                <input type="hidden" id="edit-product-index">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input type="text" id="edit-product-code" placeholder="Mã Sản Phẩm" required
                        class="p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="text" id="edit-product-name" placeholder="Tên Sản Phẩm" required
                        class="p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <select id="edit-product-category" required
                        class="p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Chọn Danh Mục</option>
                        <option value="Xe Máy">Xe Máy</option>
                        <option value="Phụ Kiện">Phụ Kiện</option>
                        <option value="Phụ Tùng">Phụ Tùng</option>
                    </select>
                    <input type="number" id="edit-product-price" placeholder="Giá Bán" required min="0"
                        class="p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="number" id="edit-product-cost" placeholder="Giá Vốn" required min="0"
                        class="p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="number" id="edit-product-quantity" placeholder="Số Lượng" required min="0"
                        class="p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="mb-4">
                    <textarea id="edit-product-description" placeholder="Mô Tả Sản Phẩm" rows="3"
                        class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <div class="flex space-x-4">
                    <button type="submit"
                        class="flex-1 py-3 rounded-lg text-lg font-bold bg-blue-500 text-white hover:bg-blue-600 transition-colors duration-200">Cập
                        Nhật</button>
                    <button type="button" onclick="closeEditModal()"
                        class="flex-1 py-3 rounded-lg text-lg font-bold bg-gray-500 text-white hover:bg-gray-600 transition-colors duration-200">Hủy</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Product data with localStorage integration
        let products = JSON.parse(localStorage.getItem('products')) || [
            { code: 'SP001', name: 'Honda Wave RSX', category: 'Xe Máy', price: 25000000, cost: 22000000, quantity: 15, description: 'Xe máy Honda Wave RSX 110cc' },
            { code: 'SP002', name: 'Yamaha Jupiter', category: 'Xe Máy', price: 27000000, cost: 24000000, quantity: 8, description: 'Xe máy Yamaha Jupiter Fi 115cc' },
            { code: 'SP003', name: 'Mũ Bảo Hiểm Royal', category: 'Phụ Kiện', price: 350000, cost: 250000, quantity: 45, description: 'Mũ bảo hiểm Royal M20' },
            { code: 'SP004', name: 'Lốp Michelin City Grip', category: 'Phụ Tùng', price: 1200000, cost: 950000, quantity: 2, description: 'Lốp Michelin City Grip 80/90-14' },
            { code: 'SP005', name: 'Dầu Nhớt Castrol', category: 'Phụ Tùng', price: 85000, cost: 65000, quantity: 0, description: 'Dầu nhớt Castrol 10W-30 1L' }
        ];

        const LOW_STOCK_THRESHOLD = 10;
        const stockStatusColors = {
            'in-stock': 'bg-green-100 text-green-800',
            'low-stock': 'bg-yellow-100 text-yellow-800',
            'out-of-stock': 'bg-red-100 text-red-800'
        };
        const stockStatusText = {
            'in-stock': 'Còn Hàng',
            'low-stock': 'Sắp Hết',
            'out-of-stock': 'Hết Hàng'
        };

        // Save products to localStorage
        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(products));
        }

        function getStockStatus(quantity) {
            if (quantity === 0) return 'out-of-stock';
            if (quantity <= LOW_STOCK_THRESHOLD) return 'low-stock';
            return 'in-stock';
        }

        function formatCurrency(amount) {
            return amount.toLocaleString('vi-VN') + ' VNĐ';
        }

        function updateDashboard() {
            const totalProducts = products.length;
            const inStockProducts = products.filter(p => getStockStatus(p.quantity) === 'in-stock').length;
            const lowStockProducts = products.filter(p => getStockStatus(p.quantity) === 'low-stock').length;
            const outOfStockProducts = products.filter(p => getStockStatus(p.quantity) === 'out-of-stock').length;

            document.getElementById('total-products').textContent = totalProducts;
            document.getElementById('in-stock-products').textContent = inStockProducts;
            document.getElementById('low-stock-products').textContent = lowStockProducts;
            document.getElementById('out-of-stock-products').textContent = outOfStockProducts;
        }

        function renderProducts(productList) {
            const tableBody = document.getElementById('product-table-body');
            tableBody.innerHTML = '';

            productList.forEach((product, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-200 transition-colors duration-200';

                const stockStatus = getStockStatus(product.quantity);
                const statusColor = stockStatusColors[stockStatus];
                const statusLabel = stockStatusText[stockStatus];

                row.innerHTML = `
                    <td class="py-3 px-6 text-left whitespace-nowrap">${product.code}</td>
                    <td class="py-3 px-6 text-left">${product.name}</td>
                    <td class="py-3 px-6 text-left">${product.category}</td>
                    <td class="py-3 px-6 text-left">${formatCurrency(product.price)}</td>
                    <td class="py-3 px-6 text-left">${product.quantity}</td>
                    <td class="py-3 px-6 text-left">
                        <span class="px-2 py-1 font-semibold leading-tight ${statusColor} rounded-full text-xs">${statusLabel}</span>
                    </td>
                    <td class="py-3 px-6 text-center space-x-2">
                        <button onclick="editProduct(${products.indexOf(product)})" class="text-blue-600 hover:underline text-sm font-medium">Sửa</button>
                        <button onclick="deleteProduct(${products.indexOf(product)})" class="text-red-600 hover:underline text-sm font-medium">Xóa</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function editProduct(index) {
            const product = products[index];
            if (!product) return;

            document.getElementById('edit-product-index').value = index;
            document.getElementById('edit-product-code').value = product.code;
            document.getElementById('edit-product-name').value = product.name;
            document.getElementById('edit-product-category').value = product.category;
            document.getElementById('edit-product-price').value = product.price;
            document.getElementById('edit-product-cost').value = product.cost;
            document.getElementById('edit-product-quantity').value = product.quantity;
            document.getElementById('edit-product-description').value = product.description;

            document.getElementById('edit-modal').classList.remove('hidden');
            document.getElementById('edit-modal').classList.add('flex');
        }

        function updateProduct(event) {
            event.preventDefault();
            const index = parseInt(document.getElementById('edit-product-index').value);
            const updatedProduct = {
                code: document.getElementById('edit-product-code').value,
                name: document.getElementById('edit-product-name').value,
                category: document.getElementById('edit-product-category').value,
                price: parseFloat(document.getElementById('edit-product-price').value),
                cost: parseFloat(document.getElementById('edit-product-cost').value),
                quantity: parseInt(document.getElementById('edit-product-quantity').value),
                description: document.getElementById('edit-product-description').value
            };

            if (products.some((p, i) => p.code === updatedProduct.code && i !== index)) {
                alert('Mã sản phẩm đã tồn tại!');
                return;
            }

            products[index] = updatedProduct;
            saveProducts();
            closeEditModal();
            updateDashboard();
            filterProducts('all');
        }

        function deleteProduct(index) {
            if (confirm('Bạn có chắc chắn muốn xóa sản phẩm này?')) {
                products.splice(index, 1);
                saveProducts();
                updateDashboard();
                filterProducts('all');
            }
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            document.getElementById('edit-modal').classList.remove('flex');
        }

        function filterProducts(status) {
            const filterButtons = document.querySelectorAll('button[id^="filter-"]');
            filterButtons.forEach(btn => btn.classList.remove('bg-blue-500', 'text-white'));

            let filteredList = [];
            if (status === 'all') {
                filteredList = products;
                document.getElementById('filter-all').classList.add('bg-blue-500', 'text-white');
            } else {
                filteredList = products.filter(product => getStockStatus(product.quantity) === status);
                document.getElementById(`filter-${status}`).classList.add('bg-blue-500', 'text-white');
            }

            renderProducts(filteredList);
        }

        function searchProducts() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const searchResults = products.filter(product =>
                product.code.toLowerCase().includes(searchTerm) ||
                product.name.toLowerCase().includes(searchTerm) ||
                product.category.toLowerCase().includes(searchTerm)
            );
            renderProducts(searchResults);
        }

        function importExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const workbook = XLSX.read(e.target.result, { type: 'binary' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const data = XLSX.utils.sheet_to_json(worksheet);

                    const importedProducts = data.map(row => ({
                        code: row['Mã SP'] || row['Code'] || '',
                        name: row['Tên Sản Phẩm'] || row['Name'] || '',
                        category: row['Danh Mục'] || row['Category'] || '',
                        price: parseFloat(row['Giá Bán'] || row['Price'] || 0),
                        cost: parseFloat(row['Giá Vốn'] || row['Cost'] || 0),
                        quantity: parseInt(row['Số Lượng'] || row['Quantity'] || 0),
                        description: row['Mô Tả'] || row['Description'] || ''
                    }));

                    const validProducts = importedProducts.filter(product => {
                        if (!product.code || !product.name) return false;
                        if (products.some(p => p.code === product.code)) {
                            console.warn(`Sản phẩm với mã ${product.code} đã tồn tại và sẽ bị bỏ qua`);
                            return false;
                        }
                        return true;
                    });

                    if (validProducts.length > 0) {
                        products.push(...validProducts);
                        saveProducts();
                        updateDashboard();
                        filterProducts('all');
                        alert(`Đã import thành công ${validProducts.length} sản phẩm!`);
                    } else {
                        alert('Không có sản phẩm hợp lệ nào để import!');
                    }
                } catch (error) {
                    console.error('Error importing Excel:', error);
                    alert('Có lỗi xảy ra khi import file Excel. Vui lòng kiểm tra định dạng file.');
                }
            };
            reader.readAsBinaryString(file);
            event.target.value = '';
        }

        function exportExcel() {
            if (products.length === 0) {
                alert('Không có dữ liệu để xuất!');
                return;
            }

            const exportData = products.map(product => ({
                'Mã SP': product.code,
                'Tên Sản Phẩm': product.name,
                'Danh Mục': product.category,
                'Giá Bán': product.price,
                'Giá Vốn': product.cost,
                'Số Lượng': product.quantity,
                'Trạng Thái': stockStatusText[getStockStatus(product.quantity)],
                'Mô Tả': product.description
            }));

            const workbook = XLSX.utils.book_new();
            const worksheet = XLSX.utils.json_to_sheet(exportData);

            const colWidths = [
                { wch: 10 }, { wch: 25 }, { wch: 15 }, { wch: 15 },
                { wch: 15 }, { wch: 10 }, { wch: 15 }, { wch: 30 }
            ];
            worksheet['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(workbook, worksheet, 'Danh Sách Sản Phẩm');

            const currentDate = new Date().toISOString().split('T')[0];
            const filename = `DanhSachSanPham_${currentDate}.xlsx`;

            XLSX.writeFile(workbook, filename);
        }

        // Close modal when clicking outside
        document.getElementById('edit-modal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateDashboard();
            filterProducts('all');
        });
    </script>

</body>

</html>